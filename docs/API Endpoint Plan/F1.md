# Mapping Flow F1: Cứu hộ - Nhận diện rắn (Emergency Rescue)

Bảng dưới đây map các bước trong Flow F1 với các API endpoint trong kế hoạch.

| Screen | Action | Backend Process | Endpoint | Method | Note |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **1. Trang chủ** | Member bấm SOS | - Tạo `SnakebiteIncident` <br> - Tạo `RescuerRequest` | `/api/incidents/sos` | `POST` | Tạo incident với Location trước. |
| **2. Cảnh báo khẩn cấp** | Member thấy Rescuer trên map | - Theo dõi vị trí Rescuer | `/api/missions/{id}/tracking` | `GET` | Stream vị trí rescuer. |
| **3. Chụp ảnh rắn** | Member chụp ảnh rắn | - Upload Cloudinary <br> - Gọi YOLO Model | `/api/identification/predict` | `POST` | Trả về `ai_results` (species, confidence). |
| **4. Kết quả nhận diện** | System trả kết quả | - Lấy thông tin loài <br> - Lấy `FirstAidGuidelineOverride` | *(Included in predict response)* <br> OR `/api/snakes/{slug}` | `POST` / `GET` | Response của predict nên trả kèm sơ bộ thông tin loài. |
| **5. Hướng dẫn sơ cứu** | User xem cách sơ cứu | - Lấy hướng dẫn theo `Species` + `Venom` | `/api/first-aid/species/{slug}` | `GET` | |
| **6. Nhập triệu chứng** | User nhập triệu chứng & chụp vết cắn | - Cập nhật `Symptoms` vào Incident <br> - Tính `SeverityLevel` | `/api/incidents/{id}/symptoms` | `PUT` | *New Endpoint needed* |
| **7. Hướng dẫn chi tiết** | System hiện đánh giá | - Trả về `SeverityLevel` <br> - Lấy hướng dẫn chi tiết | `/api/incidents/{id}` | `GET` | Lấy lại thông tin incident đã được update. |

## Thêm mới Endpoint vào API_Plan.md
Để hỗ trợ flow nhập triệu chứng sau khi đã tạo SOS (bước 1 -> bước 6), cần bổ sung endpoint update incident:

- **PUT** `/api/incidents/{id}/symptoms` - Update symptoms and recalculate severity for an existing incident.
